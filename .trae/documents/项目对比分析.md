# QQ农场项目对比分析报告

## 概述

本报告对比分析了当前项目 `qq-farm-server` 与参考项目 `qq-farm-bot`（https://github.com/maile456/qq-farm-bot）的功能差异和架构特点。

---

## 一、项目架构对比

### 1.1 当前项目 (qq-farm-server)

```
qq-farm-server/
├── server.js              # 服务器入口
├── src/
│   ├── AccountManager.js  # 账号管理
│   ├── FarmManager.js     # 农场管理器
│   ├── FarmConnection.js  # 单个农场连接
│   ├── config.js          # 配置常量
│   ├── proto.js           # Protobuf 定义
│   ├── utils.js           # 工具函数
│   ├── gameConfig.js      # 游戏配置
│   └── qqQrLogin.js       # QQ扫码登录
├── sdk/                   # Node.js SDK
├── proto/                 # Protobuf 文件
├── gameConfig/            # 游戏配置数据
├── public/                # WebUI 静态文件
└── tools/                 # 辅助工具
```

**特点：**
- 纯 Node.js 后端，原生 JavaScript
- 简单的静态 HTML/CSS/JS 前端
- 基于文件存储 (accounts.json)
- WebSocket 实时通信
- RESTful API 设计

### 1.2 参考项目 (qq-farm-bot)

```
qq-farm-bot/
├── server/                  # 后端服务
│   ├── index.js             # 服务器入口 (Express + Socket.io)
│   ├── bot-instance.js      # Bot 实例 (核心农场逻辑)
│   ├── bot-manager.js       # Bot 管理器
│   ├── routes.js            # REST API 路由
│   ├── auth.js              # JWT 认证
│   ├── database.js          # SQLite 数据库
│   └── qr-service.js        # QR 扫码登录服务
├── web/                     # 前端 (Vue 3 SPA)
│   └── src/
│       ├── views/           # 页面
│       ├── layouts/         # 布局组件
│       ├── stores/          # Pinia 状态管理
│       ├── api/             # Axios API 封装
│       └── socket/          # Socket.io 客户端
├── src/                     # 共享代码
├── proto/                   # Protobuf 协议
├── gameConfig/              # 游戏数据
└── .github/workflows/       # CI/CD 工作流
```

**特点：**
- 前后端分离架构
- Vue 3 + Vite 6 + Element Plus 现代前端
- SQLite 数据库存储 (sql.js)
- Socket.io 实时通信
- JWT 认证 + 权限系统
- Docker 部署支持
- GitHub Actions CI/CD

---

## 二、功能对比

### 2.1 核心功能对比表

| 功能 | 当前项目 | 参考项目 | 差异说明 |
|------|---------|---------|---------|
| **农场自动化** | | | |
| 自动收获 | ✅ | ✅ | 相同 |
| 智能种植 | ✅ 基础 | ✅ 高级 | 参考项目有经验/小时效率排名 |
| 自动施肥 | ✅ | ✅ | 相同 |
| 自动除草/除虫/浇水 | ✅ | ✅ | 相同 |
| 自动任务 | ✅ | ✅ | 相同 |
| 自动出售 | ✅ | ✅ | 相同 |
| **土地管理** | | | |
| 自动解锁土地 | ❌ | ✅ | 参考项目新增 |
| 自动升级土地 | ❌ | ✅ | 参考项目新增 |
| 土地详情查看 | ❌ | ✅ | 参考项目有完整土地状态页 |
| **好友系统** | | | |
| 自动偷菜 | ✅ | ✅ | 相同 |
| 帮好友操作 | ✅ | ✅ | 相同 |
| 智能预筛选 | ❌ | ✅ | 参考项目跳过无事可做的好友 |
| 跳过白萝卜 | ❌ | ✅ | 参考项目可配置 |
| **每日奖励** | | | |
| 商城免费礼包 | ❌ | ✅ | 参考项目新增8个每日奖励功能 |
| 分享奖励 | ❌ | ✅ | 参考项目新增 |
| 月卡奖励 | ❌ | ✅ | 参考项目新增 |
| 邮箱奖励 | ❌ | ✅ | 参考项目新增 |
| QQ会员奖励 | ❌ | ✅ | 参考项目新增 |
| 图鉴奖励 | ❌ | ✅ | 参考项目新增 |
| 点券购买化肥 | ❌ | ✅ | 参考项目新增 |
| 使用化肥礼包 | ❌ | ✅ | 参考项目新增 |
| **用户系统** | | | |
| 多用户权限 | ❌ | ✅ | 参考项目有管理员/普通用户 |
| JWT 认证 | ❌ | ✅ | 参考项目有完整认证 |
| 账号绑定 | ❌ | ✅ | 参考项目普通用户只能操作授权账号 |
| **前端界面** | | | |
| WebUI | ✅ 基础 | ✅ 高级 | 参考项目使用 Vue 3 + Element Plus |
| 深色/浅色主题 | ❌ | ✅ | 参考项目支持 |
| 移动端适配 | ❌ | ✅ | 参考项目响应式设计 |
| 实时日志 | ✅ | ✅ | 参考项目更完善的日志面板 |
| 仪表盘统计 | 基础 | 高级 | 参考项目有更丰富的统计卡片 |
| 种植效率排行 | ❌ | ✅ | 参考项目有完整排行页面 |
| **部署运维** | | | |
| Docker 支持 | ❌ | ✅ | 参考项目有完整 Docker 配置 |
| CI/CD | ❌ | ✅ | 参考项目有 GitHub Actions |
| 自动部署 | ❌ | ✅ | 参考项目支持自动部署到服务器 |

### 2.2 详细功能差异

#### 2.2.1 参考项目独有的核心功能

1. **每日奖励系统 (8个功能)**
   - 商城免费礼包领取
   - 分享奖励自动领取
   - 月卡每日奖励
   - 邮箱奖励自动领取
   - QQ会员每日礼包
   - 图鉴奖励自动领取
   - 点券购买化肥
   - 使用化肥礼包

2. **土地管理增强**
   - 自动解锁新土地（开拓）
   - 自动升级土地等级
   - 详细的土地状态页面（每块地的作物、生长阶段、剩余时间）

3. **好友系统优化**
   - 智能预筛选：根据好友列表摘要跳过无事可做的好友
   - 可配置跳过白萝卜偷取
   - 经验满后是否继续帮忙的可配置选项

4. **种植系统优化**
   - 基于经验/小时效率的作物排名
   - 支持多季作物计算
   - 可指定种植特定作物
   - 白萝卜仙人模式（疯狂种植白萝卜）

5. **用户权限系统**
   - 管理员/普通用户两级角色
   - JWT 认证
   - 账号权限绑定（普通用户只能操作被授权的 QQ 号）
   - Session 数据 AES-256-CBC 加密存储

---

## 三、技术栈对比

### 3.1 后端技术

| 技术 | 当前项目 | 参考项目 |
|------|---------|---------|
| 框架 | Express | Express |
| 实时通信 | WebSocket (ws) | Socket.io |
| 数据库 | 文件存储 (JSON) | SQLite (sql.js) |
| 认证 | 无 | JWT (HMAC-SHA256) |
| 加密 | 无 | AES-256-CBC |
| 协议 | Protobuf | Protobuf |

### 3.2 前端技术

| 技术 | 当前项目 | 参考项目 |
|------|---------|---------|
| 框架 | 原生 JavaScript | Vue 3 |
| 构建工具 | 无 | Vite 6 |
| UI 组件库 | 无 | Element Plus |
| 状态管理 | 无 | Pinia |
| 路由 | 无 | Vue Router |
| HTTP 客户端 | 原生 fetch | Axios |
| 实时通信 | WebSocket | Socket.io Client |

### 3.3 部署运维

| 技术 | 当前项目 | 参考项目 |
|------|---------|---------|
| Docker | ❌ | ✅ |
| Docker Compose | ❌ | ✅ (生产/开发双配置) |
| CI/CD | ❌ | ✅ (GitHub Actions) |
| 自动部署 | ❌ | ✅ |
| 跨平台镜像 | ❌ | ✅ |

---

## 四、代码质量对比

### 4.1 架构设计

**当前项目：**
- 简单直接，易于理解
- 功能集中在 FarmConnection.js
- 缺乏模块化设计

**参考项目：**
- 更清晰的职责分离
- BotInstance 类封装单个 Bot 逻辑
- BotManager 管理多账号
- 数据库层独立封装

### 4.2 功能开关设计

**当前项目：**
```javascript
// 简单的配置对象
config: {
  farmCheckInterval: 10,
  friendCheckInterval: 10,
  enableSteal: true,
  enableFriendHelp: true,
  enableSell: true
}
```

**参考项目：**
```javascript
// 详细的功能开关
featureToggles: {
  // 农场基础功能
  autoHarvest: true,
  autoPlant: true,
  autoFertilize: false,
  autoWeed: true,
  autoPest: true,
  autoWater: true,
  autoLandUnlock: true,
  autoLandUpgrade: true,
  
  // 好友互动功能
  friendVisit: true,
  autoSteal: true,
  friendHelp: true,
  friendPest: true,
  helpEvenExpFull: true,
  skipStealRadish: true,
  
  // 系统功能
  autoTask: true,
  autoSell: true,
  autoBuyFertilizer: false,
  
  // 每日奖励功能
  autoFreeGifts: true,
  autoShareReward: true,
  autoMonthCard: true,
  autoEmailReward: true,
  autoVipGift: true,
  autoIllustrated: true,
  autoFertilizerBuy: false,
  autoFertilizerUse: false,
}
```

### 4.3 日志系统

**当前项目：**
- 简单的日志数组
- 基础的颜色区分

**参考项目：**
- 带图标的标签系统
- 日志持久化到数据库
- 分级日志（info/warn/error）
- 实时日志推送

---

## 五、建议改进方向

### 5.1 高优先级（核心功能）

1. **每日奖励系统**
   - 实现 8 个每日奖励功能
   - 每小时自动检查一次
   - 防止重复领取的日期标记

2. **土地管理增强**
   - 自动解锁新土地
   - 自动升级土地
   - 土地详情页面

3. **种植系统优化**
   - 经验/小时效率排名
   - 多季作物支持
   - 指定作物种植

### 5.2 中优先级（用户体验）

1. **前端升级**
   - 考虑引入 Vue 3 + Element Plus
   - 深色/浅色主题
   - 移动端适配

2. **数据库迁移**
   - 从文件存储迁移到 SQLite
   - 数据加密存储

3. **用户系统**
   - 多用户权限
   - JWT 认证

### 5.3 低优先级（运维部署）

1. Docker 支持
2. CI/CD 工作流
3. 自动部署脚本

---

## 六、参考代码片段

### 6.1 每日奖励系统核心代码

```javascript
// 每日奖励状态追踪
this.dailyRewardState = {
  freeGifts: '',        // 商城免费礼包完成日期
  share: '',            // 分享奖励完成日期
  monthCard: '',        // 月卡奖励完成日期
  email: '',            // 邮箱奖励完成日期
  vipGift: '',          // QQ会员奖励完成日期
  illustrated: '',      // 图鉴奖励完成日期
  fertilizerBuy: '',    // 化肥购买完成日期
  fertilizerUse: '',    // 化肥礼包使用完成日期
};

// 每小时执行一次
_initDailyRewardSystem() {
  setTimeout(() => this._runDailyRewards(), 8000);
  this.dailyRoutineTimer = setInterval(() => this._runDailyRewards(), 60 * 60 * 1000);
}
```

### 6.2 土地解锁/升级

```javascript
// 分析土地时检查可解锁/可升级
analyzeLands(lands) {
  const result = {
    unlockable: [],     // 可解锁（开拓）的土地
    upgradable: [],     // 可升级的土地
    // ...
  };
  
  for (const land of lands) {
    // 未解锁的土地 → 检查是否可以解锁
    if (!land.unlocked) {
      if (land.could_unlock) {
        result.unlockable.push(id);
      }
      continue;
    }
    
    // 已解锁的土地 → 检查是否可以升级
    if (land.could_upgrade) {
      result.upgradable.push(id);
    }
  }
  return result;
}
```

### 6.3 智能预筛选好友

```javascript
// 根据好友列表摘要数据跳过确定无事可做的好友
const friendsToVisit = [];
let skippedCount = 0;

for (const f of friends) {
  const stealNum = p ? toNum(p.steal_plant_num) : 0;
  const dryNum = p ? toNum(p.dry_num) : 0;
  const weedNum = p ? toNum(p.weed_num) : 0;
  const insectNum = p ? toNum(p.insect_num) : 0;
  
  // 根据开关决定是否有事可做
  const canSteal = this.featureToggles.autoSteal && stealNum > 0;
  const canHelp = this.featureToggles.friendHelp && (dryNum > 0 || weedNum > 0 || insectNum > 0);
  
  // 有可偷 或 有可帮忙 → 访问
  if (canSteal || canHelp) {
    friendsToVisit.push({ gid, name, level: toNum(f.level), stealNum, dryNum, weedNum, insectNum });
  } else {
    skippedCount++;
  }
}
```

---

## 七、总结

参考项目 `qq-farm-bot` 相比当前项目有以下显著优势：

1. **功能更丰富**：8个每日奖励功能、土地管理增强、智能好友预筛选
2. **技术更先进**：Vue 3 现代前端、SQLite 数据库、Socket.io
3. **用户体验更好**：深色主题、移动端适配、实时日志
4. **运维更完善**：Docker 支持、CI/CD、自动部署

建议优先实现每日奖励系统和土地管理功能，这些是提升农场效率的核心功能。前端升级和数据库迁移可以作为中长期规划。
